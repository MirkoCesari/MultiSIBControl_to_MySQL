# MultiSIBControl to MySQL

This script periodically retrieves live data from a PC running the **MultiSIBControl** application (http://www.multisibcontrol.net/), parses the data from the HTML page, and logs it into a **MySQL database**. 
It is designed to overcome challenges encountered when using the SQLite database generated by MultiSIBControl, particularly in **Grafana** environments where database locking issues are common.

---

## Features

- **Live Data Retrieval**: Fetches real-time data from a MultiSIBControl device.
- **HTML Data Parsing**: Extracts key measurements (e.g., voltage, current, SOC, temperature) using `BeautifulSoup`.
- **Database Logging**: Saves parsed data into a MySQL database for reliable storage and analysis.
- **Error Handling & Logging**: Comprehensive logging with rotating log files for easy debugging.
- **Configurable**: Easily adjust device and database settings via a JSON configuration file.
&nbsp;
#### Features to be implemented:

  - **Pylontech Parametrization**: At the moment the script will fetch data only from 3 pylontech, if not present the NULL value will be stored in the DB. In the next update the number of installed Pylontech will be added in the json file.
---

## Installation

### 1. Install Dependencies

Ensure you have **Python 3.x** installed, then run the following command to install required libraries:

```bash
pip install requests mysql-connector-python beautifulsoup4
```

### 2. Prepare the HTML Template

Copy the file `WebResponseTemplateEN.html` into the MultiSIBControl installation folder. This ensures the script can parse the deviceâ€™s live data correctly.

### 3. Create the Configuration File

Create a file named `ConfigMultiSIBControl.json` in the script's directory with the following structure:

```json
{
    "MultiSIBControl": {
        "AddressIP": "MultiSIBControl_IP_Address",
        "Port": "MultiSIBControl_Port",
        "APIKey": "MultiSIBControl_APIKEY"
    },
    "DB": {
        "host": "localhost",
        "user": "your_db_user",
        "password": "your_db_password",
        "database": "your_db_name",
        "table": "your_table_name"
    }
}
```

Replace the placeholder values with your actual configuration.
In the files an example of JSON confiruation is present.

---

## Database Requirements

### MySQL Table Schema

Ensure your MySQL table has the following structure:

```sql
CREATE TABLE your_table_name (
    timestamp DATETIME,
    P1_V FLOAT,
    P1_A FLOAT,
    P1_SOC FLOAT,
    P1_TEMP FLOAT,
    P1_REMAIN_AH FLOAT,
    P1_IMBALANCE FLOAT,
    P2_V FLOAT,
    P2_A FLOAT,
    P2_SOC FLOAT,
    P2_TEMP FLOAT,
    P2_REMAIN_AH FLOAT,
    P2_IMBALANCE FLOAT,
    P3_V FLOAT,
    P3_A FLOAT,
    P3_SOC FLOAT,
    P3_TEMP FLOAT,
    P3_REMAIN_AH FLOAT,
    P3_IMBALANCE FLOAT,
    Pylon_SOC FLOAT,
    Pylon_W FLOAT,
    Pylon_A FLOAT,
    Pylon_V FLOAT,
    Pylon_Temp FLOAT,
    Pylon_Remain_AH FLOAT,
    Pylon_Remain_kWh FLOAT,
    Inverter_Load_W FLOAT,
    Inverter_Load_Percent FLOAT,
    Inverter_Grid_W FLOAT,
    Inverter_Grid_V FLOAT,
    Inverter_PV_W FLOAT
);
```

---

## How to Run the Script

1. **Ensure the configuration file** (`ConfigMultiSIBControl.json`) is correctly set up.
2. **Run the script**:

    ```bash
    python MultiSIBControl.py
    ```

3. **Stop the script** gracefully using `Ctrl+C`.

---

## Log Files

The script logs events and errors to `ReadFromMultiSIBControl.log` and maintains up to **5 rotating log files**, each with a maximum size of **2 MB**.

---

## Troubleshooting

- **Database Connection Issues**: Check your MySQL credentials and ensure the database is running.
- **Device Connection Errors**: Ensure the MultiSIBControl device is accessible at the specified IP and port.
- For other configuration or documentation related to the MultiSIBControl application follow the instruction in their website: http://www.multisibcontrol.net/

## Note

I am not affiliated with MultiSIBControl, nor am I the owner of the MultiSIBControl application.  
I am just a user who enjoys and uses the application.
